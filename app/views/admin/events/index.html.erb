<%# app/views/admin/events/index.html.erb %>
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Manage Events</h1>
    <%= link_to "Create New Event", new_admin_event_path, class: "btn btn-primary" %>
  </div>

  <%# Search and Filter Form %>
  <%= form_with(url: admin_events_path, method: :get, local: true, class: "mb-4") do |form| %>
    <div class="row g-3">
      <div class="col-md-8">
        <%= form.text_field :search, value: params[:search], class: "form-control", placeholder: "Search by title, venue, or description..." %>
      </div>
      <div class="col-md-4">
        <%= form.submit "Search", class: "btn btn-secondary w-100" %>
      </div>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th><%= sort_link_to "Title", :title %></th>
            <th><%= sort_link_to "Type", :event_type %></th>
            <th><%= sort_link_to "Start Date", :start_date %></th>
            <th><%= sort_link_to "End Date", :end_date %></th>
            <th><%= sort_link_to "Time", :event_time %></th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @events.each do |event| %>
            <tr>
              <td><%= link_to event.title, admin_event_path(event) %></td>
              <td><%= event.event_type.titleize %></td>
              <td><%= event.start_date&.to_formatted_s(:long) %></td>
              <td><%= event.end_date&.to_formatted_s(:long) %></td>
              <td><%= event.event_time&.strftime("%I:%M %p") %></td>
              <td class="text-end">
                <div class="d-none d-md-block">
                  <%= link_to "View", admin_event_path(event), class: "btn btn-sm btn-info" %>
                  <%= link_to "Edit", edit_admin_event_path(event), class: "btn btn-sm btn-warning" %>
                  <%= link_to "Delete", admin_event_path(event), data: { "turbo-method": :delete, confirm: "Are you sure you want to delete this event?" }, class: "btn btn-sm btn-danger" %>
                </div>
                <div class="d-block d-md-none" data-controller="mobile-actions">
                  <button data-action="mobile-actions#toggle" class="btn btn-sm btn-secondary">Actions</button>
                  <div data-mobile-actions-target="menu" class="hidden mobile-actions-dropdown">
                    <%= link_to "View", admin_event_path(event), class: "btn btn-sm btn-info" %>
                    <%= link_to "Edit", edit_admin_event_path(event), class: "btn btn-sm btn-warning" %>
                    <%= link_to "Delete", admin_event_path(event), data: { "turbo-method": :delete, confirm: "Are you sure you want to delete this event?" }, class: "btn btn-sm btn-danger" %>
                  </div>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="card-footer">
      <%# Pagination %>
      <div class="d-flex justify-content-center">
        <%== pagy_bootstrap_nav(@pagy) if @pagy %>
      </div>
    </div>
  </div>
</div>
