<%# app/views/admin/posts/_form.html.erb %>
<%= form_with(model: [:admin, @post], local: true, class: "needs-validation", novalidate: true, data: { controller: "autosave form-submission validation sender post-form", validation_target: "form", sender_options: office_sender_options.to_json }) do |form| %>
  <%= render 'shared/error_messages', object: @post %>

  <div class="mb-3">
    <%= form.label :title, class: "form-label" %>
    <%= form.text_field :title, class: "form-control", required: true %>
    <div class="invalid-feedback">
      Please provide a title.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :summary, class: "form-label" %>
    <%= form.text_area :summary, rows: 3, class: "form-control", data: { controller: "character-counter" } %>
    <div class="form-text" data-character-counter-target="output">
      A brief summary that will appear in list views.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :content, class: "form-label" %>
    <%= form.text_area :content, class: "form-control", style: "height: 250px;" %>
  </div>

  <div class="mb-3">
    <%= form.label :status, class: "form-label" %>
    <%= form.select :status, Post.statuses.keys.map { |status| [status.humanize, status] }, {}, class: "form-select" %>
  </div>

  <div class="mb-3">
    <%= form.label :post_type, class: "form-label" %>
    <%= form.select :post_type, Post.post_types.keys.map { |pt| [pt.humanize, pt] }, {}, class: "form-select", data: { action: "change->post-form#toggleMemoFields", post_form_target: "postType" } %>
  </div>

  <div class="mb-3">
    <%= form.label :severity, class: "form-label" %>
    <%= form.select :severity, Post.severities.keys.map { |s| [s.humanize, s] }, {}, class: "form-select" %>
  </div>

  <div data-post-form-target="memoFields">
    <div class="mb-3">
      <%= form.label :source, class: "form-label" %>
      <%= form.select :source, Post.sources.keys.map { |source| [source.humanize, source] }, {}, class: "form-select", data: { action: "change->sender#updateSender", sender_target: "source" } %>
    </div>

    <div class="mb-3">
      <%= form.label :sender_name, class: "form-label" %>
      <%= form.text_field :sender_name, class: "form-control", data: { sender_target: "senderName" } %>
    </div>

    <div class="mb-3">
      <%= form.label :sender_title, class: "form-label" %>
      <%= form.text_field :sender_title, class: "form-control", data: { sender_target: "senderTitle" } %>
    </div>
  </div>

  <div class="mb-3 form-check">
    <%= form.check_box :featured, class: "form-check-input" %>
    <%= form.label :featured, class: "form-check-label" %>
  </div>

  <div class="mb-3">
    <%= form.label :published_at, "Publish Time", class: "form-label" %>
    <%= form.datetime_local_field :published_at, class: "form-control" %>
    <div class="form-text">
      Leave blank to publish immediately.
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <%= link_to "Cancel", admin_posts_path, class: "btn btn-secondary me-2" %>
    <%= form.submit "Save Memo", class: "btn btn-primary", data: { form_submission_target: "submit" } %>
  </div>
<% end %>
