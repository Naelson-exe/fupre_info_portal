<%# app/views/admin/posts/index.html.erb %>
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Manage Memos</h1>
    <%= link_to "Create New Memo", new_admin_post_path, class: "btn btn-primary" %>
  </div>

  <%# Search and Filter Form %>
  <%= form_with(url: admin_posts_path, method: :get, local: true, class: "mb-4") do |form| %>
    <div class="row g-3">
      <div class="col-md-6">
        <%= form.text_field :search, value: params[:search], class: "form-control", placeholder: "Search by title or content..." %>
      </div>
      <div class="col-md-4">
        <%= form.select :status, options_for_select([['All Statuses', ''], ['Draft', 'draft'], ['Published', 'published']], params[:status]), {}, class: "form-select" %>
      </div>
      <div class="col-md-2">
        <%= form.submit "Filter", class: "btn btn-secondary w-100" %>
      </div>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th><%= sort_link_to "Title", :title %></th>
            <th><%= sort_link_to "Status", :status %></th>
            <th><%= sort_link_to "Created At", :created_at %></th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @posts.each do |post| %>
            <tr>
              <td><%= link_to post.title, admin_post_path(post) %></td>
              <td>
                <span class="badge bg-<%= post.published? ? 'success' : 'secondary' %>">
                  <%= post.status&.humanize %>
                </span>
              </td>
              <td><%= time_ago_in_words(post.created_at) %> ago</td>
              <td class="text-end">
                <%= link_to "View", admin_post_path(post), class: "btn btn-sm btn-info" %>
                <%= link_to "Edit", edit_admin_post_path(post), class: "btn btn-sm btn-warning" %>
                <%= link_to "Delete", admin_post_path(post), data: { turbo_method: :delete, confirm: "Are you sure you want to delete this memo?" }, class: "btn btn-sm btn-danger" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="card-footer">
      <%# Pagination %>
      <div class="d-flex justify-content-center">
        <%== pagy_bootstrap_nav(@pagy) if @pagy %>
      </div>
    </div>
  </div>
</div>
